generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
  // shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
  // ğŸ‘‰ å…ˆæŠŠ shadowDatabaseUrl å…³æ‰ï¼Œæ–¹ä¾¿æœ¬åœ° & Vercel ç”Ÿæˆ Prisma Client
}

model Shop {
  id      Int     @id @default(autoincrement())
  name    String
  address String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  billingBaseMode   String @default("none")
  billingBaseValue  Int    @default(0)
  billingExtraMode  String @default("none")
  billingExtraValue Int    @default(0)

  platformShareBasis Int   @default(0)
  shopShareBasis     Int   @default(0)
  barberShareBasis   Int   @default(0)
  enableAutoSplit    Boolean @default(false)

  barbers  Barber[]
  bookings Booking[]
}

model Barber {
  id            Int    @id @default(autoincrement())
  name          String
  shopId        Int
  workStartHour Int
  workEndHour   Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  shop     Shop     @relation(fields: [shopId], references: [id])
  bookings Booking[]
}

model Service {
  id              Int    @id @default(autoincrement())
  name            String
  durationMinutes Int
  price           Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  bookings Booking[]
}

model Booking {
  id        Int      @id @default(autoincrement())
  userName  String
  phone     String?
  shopId    Int
  barberId  Int
  serviceId Int
  startTime DateTime
  status    String   @default("scheduled")

  source    String?
  price      Int?     // ä½ ä¹Ÿå¯ä»¥å†™ Int @default(0) çœ‹ä½ æƒ³ä¸æƒ³å¼ºåˆ¶æœ‰å€¼

  payStatus  String   @default("unpaid")
  payAmount  Int      @default(0)
  payOrderNo String?
  payTime    DateTime?

  splitStatus String  @default("pending")
  splitDetail String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  shop    Shop    @relation(fields: [shopId], references: [id])
  barber  Barber  @relation(fields: [barberId], references: [id])
  service Service @relation(fields: [serviceId], references: [id])

  @@unique([barberId, startTime])

  @@index([shopId])
  @@index([barberId])
  @@index([serviceId])
  @@index([phone])
}
