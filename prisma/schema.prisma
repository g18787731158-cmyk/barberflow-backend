// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
  // shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
  // ğŸ‘‰ å…ˆæŠŠ shadowDatabaseUrl å…³æ‰ï¼Œæ–¹ä¾¿æœ¬åœ° & Vercel ç”Ÿæˆ Prisma Client
}

model Shop {
  id      Int     @id @default(autoincrement())
  name    String
  address String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  billingBaseMode   String @default("none")
  billingBaseValue  Int    @default(0)
  billingExtraMode  String @default("none")
  billingExtraValue Int    @default(0)

  platformShareBasis Int   @default(0)
  shopShareBasis     Int   @default(0)
  barberShareBasis   Int   @default(0)
  enableAutoSplit    Boolean @default(false)

  barbers  Barber[]
  bookings Booking[]
}

model Barber {
  id            Int    @id @default(autoincrement())
  name          String
  shopId        Int
  workStartHour Int
  workEndHour   Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  shop     Shop     @relation(fields: [shopId], references: [id])
  bookings Booking[]

  // âœ… æ¯ä¸ªç†å‘å¸ˆå¯¹ä¸åŒæœåŠ¡çš„ä¸“å±å®šä»·
  barberServices BarberService[]
}

model Service {
  id              Int    @id @default(autoincrement())
  name            String
  durationMinutes Int
  price           Int     // é»˜è®¤ä»·ï¼ˆé€šç”¨ä»·ï¼‰

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  bookings Booking[]

  // âœ… è¢«å“ªäº›ç†å‘å¸ˆå•ç‹¬å®šä»·
  barberServices BarberService[]
}

// âœ… æ–°å¢ï¼šç†å‘å¸ˆ-æœåŠ¡å®šä»·è¡¨ï¼ˆå¯é€‰è¦†ç›–ä»·æ ¼ & æ—¶é•¿ï¼‰
model BarberService {
  barberId        Int
  serviceId       Int
  price           Int?   // è‹¥ä¸ºç©ºï¼Œå›é€€ç”¨ Service.price
  durationMinutes Int?   // è‹¥ä¸ºç©ºï¼Œå›é€€ç”¨ Service.durationMinutes

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  barber  Barber  @relation(fields: [barberId], references: [id])
  service Service @relation(fields: [serviceId], references: [id])

  @@id([barberId, serviceId])
}

model Booking {
  id        Int      @id @default(autoincrement())
  userName  String
  phone     String?
  shopId    Int
  barberId  Int
  serviceId Int
  startTime DateTime
  status    String   @default("scheduled")

  source    String?
  price     Int?     // âœ… å®é™…æˆäº¤ä»·æ ¼ï¼ˆå†™æ­»åœ¨è®¢å•ä¸Šï¼‰

  payStatus  String   @default("unpaid")
  payAmount  Int      @default(0)
  payOrderNo String?
  payTime    DateTime?

  splitStatus String  @default("pending")
  splitDetail String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  shop    Shop    @relation(fields: [shopId], references: [id])
  barber  Barber  @relation(fields: [barberId], references: [id])
  service Service @relation(fields: [serviceId], references: [id])

  @@unique([barberId, startTime])

  @@index([shopId])
  @@index([barberId])
  @@index([serviceId])
  @@index([phone])
}
